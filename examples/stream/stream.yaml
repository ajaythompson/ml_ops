id: 41550f9a-c850-11eb-a55e-d90d76bdfe70
processors:
  - id: 41550f9b-c850-11eb-a55e-d90d76bdfe70
    name: load sensor data
    type: LoadStreamProcessor
    property_groups:
      default:
        path: "examples/stream/input"
        format: csv
        schema: >
          {
            "type": "struct",
            "fields": [
              {
                "name": "sensor_id",
                "type": "string",
                "nullable": false,
                "metadata": {}
              },
              {
                "name": "value",
                "type": "integer",
                "nullable": false,
                "metadata": {}
              }
            ]
          }
        view_name: sensor_data
      load_options:
        header: True
        checkpointLocation: examples/stream/checkpoint
  - id: 41550f9d-c850-11eb-a55e-d90d76bdfe70
    name: compute mean and stddev
    type: SQLProcessor
    property_groups:
      default:
        view_name: sensor_grouped_data
        query: SELECT sensor_id, mean(value) AS mean, stddev(value) AS stddev
          FROM sensor_data
          GROUP BY sensor_id
  - id: 41550f9e-c850-11eb-a55e-d90d76bdfe70
    name: compute upper and lower limit
    type: SQLProcessor
    property_groups:
      default:
        view_name: final
        query: SELECT sensor_id, mean, stddev,
          (mean + 3 * stddev) AS upper_limit,
          (mean - 3 * stddev) AS lower_limit
          FROM sensor_grouped_data
  - id: 41550f9f-c850-11eb-a55e-d90d76bdfe70
    name: write outliers data
    type: WriteStreamProcessor
    property_groups:
      default:
        path: "examples/stream/output"
        format: console
        mode: complete
      write_options:
        header: "true"
        checkpointLocation: examples/stream/checkpoint
relations:
  - id: 41550f9f-c850-11eb-a55e-d90d76bdfe70
    left: 41550f9b-c850-11eb-a55e-d90d76bdfe70
    right: 41550f9d-c850-11eb-a55e-d90d76bdfe70
  - id: 41550fa0-c850-11eb-a55e-d90d76bdfe70
    left: 41550f9d-c850-11eb-a55e-d90d76bdfe70
    right: 41550f9e-c850-11eb-a55e-d90d76bdfe70
  - id: 41550fa1-c850-11eb-a55e-d90d76bdfe70
    left: 41550f9e-c850-11eb-a55e-d90d76bdfe70
    right: 41550f9f-c850-11eb-a55e-d90d76bdfe70
